<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Report - {{ student.name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;}
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-break-before { page-break-before: always; margin-top: 2rem; } /* Add margin for break */
            .print-break-inside-avoid { page-break-inside: avoid; }
            table { width: 100% !important; }
            thead { display: table-header-group; }
            tr, td, th { page-break-inside: avoid !important; }
             /* Ensure Tailwind bg colors print */
             .bg-green-100, .bg-blue-100, .bg-yellow-100, .bg-red-100, .bg-gray-50, .bg-gray-200 { print-color-adjust: exact; -webkit-print-color-adjust: exact;}
             .text-green-800, .text-blue-800, .text-yellow-800, .text-red-800, .text-gray-700 { print-color-adjust: exact; -webkit-print-color-adjust: exact;}
        }
        table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
        th, td { border: 1px solid #e2e8f0; padding: 0.5rem 0.75rem; text-align: left; font-size: 0.875rem; vertical-align: top; }
        th { background-color: #f8fafc; font-weight: 600; }
        .status-badge-report { padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; display: inline-block; }
         /* Simple header/footer for print using @page (might require WeasyPrint/browser support) */
         /*
         @page {
             size: A4;
             margin: 1cm;
             @bottom-center {
                 content: "Page " counter(page) " of " counter(pages);
                 font-size: 9pt; color: #888;
             }
             @top-left {
                 content: "{{ student.name }} - Student Report";
                 font-size: 9pt; color: #888;
             }
         }
         */
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-lg shadow-lg">

        <!-- Header -->
        <div class="flex justify-between items-start border-b pb-4 mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">{{ student.name }}</h1>
                <p class="text-sm text-gray-600">{{ student.className }}</p>
                <p class="text-sm text-gray-500">UID: {{ student.uid | default('-') }} | Roll: {{ student.rollNumber | default('-') }}</p>
            </div>
            <div class="text-right flex-shrink-0">
                <p class="text-lg font-semibold text-blue-700">Student Report</p>
                <p class="text-xs text-gray-500">Generated: {{ generated_date }}</p>
                 {# --- Hide Print button when printing --- #}
                 <button onclick="window.print()" class="no-print mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1">
                    <i class="fas fa-print mr-1"></i> Print / Save PDF
                 </button>
            </div>
        </div>

        <!-- Overall Performance -->
        <div class="mb-6 print-break-inside-avoid">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Overall Performance</h2>
            <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-md border">
                <div>
                    <span class="text-xs text-gray-500 block uppercase tracking-wider">Overall Grade</span>
                    <span class="text-2xl font-bold text-gray-800">{{ student.overallGrade | default('N/A') }}{% if student.overallGrade is not none %}%{% endif %}</span>
                </div>
                 <div>
                    <span class="text-xs text-gray-500 block uppercase tracking-wider">Status</span>
                    {% set status_text = get_status_from_grade(student.overallGrade) %}
                    {% set status_classes = 'bg-gray-200 text-gray-700' %}
                    {% if status_text == 'Excellent' %}{% set status_classes = 'bg-green-100 text-green-800' %}
                    {% elif status_text == 'Good' %}{% set status_classes = 'bg-blue-100 text-blue-800' %}
                    {% elif status_text == 'Needs Help' %}{% set status_classes = 'bg-yellow-100 text-yellow-800' %}
                    {% elif status_text == 'At Risk' %}{% set status_classes = 'bg-red-100 text-red-800' %}
                    {% endif %}
                    <span class="status-badge-report {{ status_classes }}">{{ status_text }}</span>
                 </div>
            </div>
        </div>

        <!-- Basic Information -->
        <div class="mb-6 print-break-inside-avoid">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Basic Information</h2>
             <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 text-sm">
                 <div><strong class="text-gray-600 w-24 inline-block">Email:</strong> {{ student.email | default('-') }}</div>
                 <div><strong class="text-gray-600 w-24 inline-block">Parent Ph:</strong> {{ student.parentPhone | default('-') }}</div>
                 <div><strong class="text-gray-600 w-24 inline-block">Join Date:</strong> {{ student.joinDate | default('-') }}</div>
                 <div><strong class="text-gray-600 w-24 inline-block">Campus:</strong> {{ student.campus | default('-') }}</div>
                 <div class="sm:col-span-2"><strong class="text-gray-600 w-24 inline-block">Robotics Team:</strong> {{ student.roboticsTeam | default('-') }}</div>
             </div>
        </div>

         <!-- Skills -->
         <div class="mb-6 print-break-inside-avoid">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Skills</h2>
            <div class="flex flex-wrap gap-2">
                {% if student.skills %}
                    {% for skill in student.skills %}
                    <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium">{{ skill }}</span>
                    {% endfor %}
                {% else %}<p class="text-sm text-gray-500 italic">No skills listed.</p>{% endif %}
            </div>
         </div>

        <!-- Assignments & Scores -->
        <div class="print-break-before">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Assignments & Scores</h2>
            {% if assignments %}
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Due Date</th>
                            <th>Max</th>
                            <th>Score</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for assignment in assignments %}
                        <tr class="{% if loop.index is odd %}bg-white{% else %}bg-gray-50/50{% endif %}">
                            <td class="font-medium">{{ assignment.title }}</td>
                            <td>{{ assignment.type }}</td>
                            <td>{{ assignment.dueDate }}</td>
                            <td class="text-center">{{ assignment.totalPoints }}</td>
                            <td class="text-center font-medium">
                                {% if assignment.score is not none %}{{ assignment.score }}{% else %}-{% endif %}
                            </td>
                            <td class="text-center">
                                {% if assignment.score is not none and assignment.totalPoints is defined and assignment.totalPoints %}
                                     {% set score_percent = (assignment.score / assignment.totalPoints * 100)|round %}
                                     <span class="font-semibold
                                        {% if score_percent >= 90 %}text-green-700
                                        {% elif score_percent >= 70 %}text-blue-700
                                        {% elif score_percent >= 60 %}text-yellow-700
                                        {% else %}text-red-700
                                        {% endif %}">
                                        {{ score_percent }}%
                                     </span>
                                {% elif assignment.score is none %}
                                    <span class="text-gray-400 text-xs">PENDING</span>
                                {% else %}
                                    <span class="text-gray-500">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-sm text-gray-500 italic mt-4">No assignments found for this student's class.</p>
            {% endif %}
        </div>

        <!-- Footer -->
        <div class="mt-10 pt-4 border-t text-center text-xs text-gray-400">
            Robotics Academy - Student Management System
        </div>
    </div>
</body>
</html>
